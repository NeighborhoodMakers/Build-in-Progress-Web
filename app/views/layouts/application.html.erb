<!DOCTYPE html>

<html>
<head>
  <title>Build in Progress</title>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag "application-all", :media => "all" %>
  <%= stylesheet_link_tag "application-v01", :media => "all" %>

   <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700' rel='stylesheet' type='text/css'>
</head>

<script type="text/javascript">
$(function(){
	// Sets up drop down menu
	$('.dropdown-toggle').dropdown();

	$('.dropdown-toggle').click(function(){
		// add ellipsis to notifications that overflow
		$('.notification-text').each(function(){
  			$(this).ellipsis();
  		});
	});

	//Fixes input element clicking problem
	$('.dropdown input, .dropdown label').click(function(e){
		e.stopPropagation();
	});
});
</script>

<body>
	<div class ="navbar">
		
			<%= link_to image_tag("build_in_progress_logo.png"), home_index_path, :class=> "brand logo" %>
	
			<ul class="nav">
				<li><%=link_to "Projects", projects_path %></li>
				<li><%=link_to "Collections", collections_path %></li>
			</ul>	
			
			<ul class="pull-right nav">
				<% if false %>
					<form class="navbar-search">
						<input type="text" class="search-query" placeholder="Search">
					</form>	
				<% end %>

				<li class = "dropdown pull-right navbar_notification">
					<% if user_signed_in? %>

					<% # notifications %>

					  <a href ="#" class="dropdown-toggle navbar_notification_link" data-toggle="dropdown"><icon class="fa fa-bell-o" style="font-size:17px;"></icon></a>	

					  <% # highlight the notification icon if the user has unseen notifications %>
					  <% if current_user.all_new_notifications.count > 0 %>
						  <script type="text/javascript">
						  	$('.fa-bell').addClass('active');

						  	$('.navbar_notification_link').append('<span class="badge badge-warning"><%=current_user.all_new_notifications.count%>');
						  </script>
					   <% end %>

					   <% if current_user.all_notifications.count > 0 %>
						  <ul class="dropdown-menu" role="menu">
						  	<li class="notification-label">Notifications</b></li>
						  	<%= render :partial=> "users/notification.html.erb" %>
						  </ul>
						<% else %>
						<script type="text/javascript">
							$('.navbar_notification_link').click(function(){						
  									window.location.href="<%=notifications_path%>";
  							});
						</script>
					  <% end %>
										   	  
					  <% # user profile + account settings %>
					  <li class="navbar_login dropdown">		
						<a href="#" class = "dropdown-toggle" data-toggle="dropdown" style="font-weight: bold"%> <%= current_user.username %> <icon class="fa fa-sort-down" style="display:inline-table; margin-top: -3px"></icon></a>
						<ul class="dropdown-menu">
							<li><%=link_to "Profile", user_path(current_user.username) %></li>
							<li class="divider"></li>
							<li><%=link_to "Create Project", new_project_path %></li>
							<li><%=link_to "Create Collection", new_collection_path %> </li>
							<li class="divider"></li>
							<li><%=link_to "Account Settings", edit_user_registration_path %></li>
						</ul>

						<% # logout %>
					 	<li><%= link_to "Logout", destroy_user_session_path, method: :delete %></li>
					 </li>
					 
					<% else %>
						<% # login %>
						<a class="dropdown-toggle" href = "#" data-toggle="dropdown>">Sign In</a>
						<div class= "dropdown-menu" style="padding:15px">
							<%= semantic_form_for("user", :url => user_session_path, :html => {:class => "loginForm"})  do |f| %>
							  <%= f.label :username, :class=>"smallLabel" %>	
							  <%= f.text_field :username, :value=>"" %>
							  <%= f.label :password, :class=>"smallLabel" %>	
							  <%= f.password_field :password %>
							  <%= f.check_box :remember_me, :class=>"rememberMeCheck" %>
							  <%= f.label :remember_me, :class=>"rememberMeLabel smallLabel" %>
							  <%= f.submit 'Login', :class=>"login btn btn-small btn-primary" %>
							  <%= link_to "Forgot password?", new_password_path('user'), :class=>"pwForgot" %>
							<div class="clear"></div>
							<div class="loginSignUp">
							<%= link_to "Sign Up",   new_registration_path(resource_name), :class=>"btn btn-mini", :style=>'float:left'	 %>
							</div>
							<% end %>
						</div>
					<% end %>
			 	</li>
			</ul>
	</div>

<div id="loading">
  <%= image_tag("icons/loading.gif") %>
</div>

	<div id="main">
		<% if controller_name != 'steps' %>
		  <% flash.each do |name, msg| %>
		    <% if name != "timedout" %>
		    <%= content_tag :div, msg, id: "flash_#{name}" %>
		    <% end %>
		  <% end %>
	  <div class="clear"></div>
	  <% end %>
	  <%= yield %>
	</div>

	<div class="clear"></div>
	<div id="footer">
		<div class="footer_container">
			<%= link_to "About", about_path %>   |   <%= link_to "News", news_path %>   |   <%= link_to "Mobile App", android_path %>   |   <%= link_to "Help", help_path %>   |   <%= link_to "Contact", contact_path %>
		</div>
	</div>

</body>
</html>

<% # Google Analytics %>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41379809-1', 'herokuapp.com');
  ga('send', 'pageview');

  // returns the ID of an active record given the class / id of the page element (i.e., notification_30 will return 30)
  function getID(strings){
    var classes_array = strings.split(" ");
    for(var i =0; i<classes_array.length; i++){
      if(classes_array[i].match(/\d+/g)!=null){
        id = classes_array[i].match(/\d+/g)[0];
        return id;
      }
    }
  }

  $(window).load(function(){

  	// remove loading animation
  	if($('#loading').css('display')!='none'){
  		$('#loading').fadeOut(400, function(){
  		     $('#main').animate({opacity:1});
  		});
  	}else{
  		$('#main').css('opacity',1);
  	}

  	$('.notification-text').each(function(){
  		$(this).ellipsis();
  	});
  });

</script>
